<ion-header [translucent]="true" mode="md">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button mode="md" fill="clear" [routerDirection]="'back'" (click)="goBack()" class="noBg noRipple">
        <ion-icon name="chevron-back-outline" aria-hidden="true" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Payroll Setup</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-item [lines]="'full'" class="ion-margin-bottom" *ngIf="employeeDetail">
    <div class="emp_avatar" slot="start">
      <ion-avatar class="employee_img">
        <app-name-img [name]="getName(employeeDetail)" [classes]="''" *ngIf="employeeDetail.imageUrl.trim() === ''"></app-name-img>
        <img [alt]="employeeDetail.firstName" *ngIf="employeeDetail.imageUrl.trim() !== ''" src="https://ionicframework.com/docs/img/demos/avatar.svg" />
      </ion-avatar>
    </div>

    <ion-label class="emp_name">{{employeeDetail.firstName | titlecase}} {{employeeDetail.lastName || '' | titlecase}}</ion-label>

    <div class="emp_salary text-end" slot="end">
      <ion-text><small>Net Pay</small><br></ion-text>
      <ion-label class="net_salary" color="danger">{{2000 | currency: "INR"}}</ion-label>
    </div>
  </ion-item>

  <div class="text-end ion-padding-horizontal ion-margin-bottom">
    <ion-button mode="md" color="primary" shape="round" type="button" (click)="dateModal = true">
      {{getMonthYear().trim() != '' ? getMonthYear() : 'Select Month'}}
      <ion-icon name="chevron-down-outline" aria-hidden="true" slot="end"></ion-icon>
    </ion-button>
  </div>
  <ion-modal [isOpen]="dateModal" [initialBreakpoint]=".5" [breakpoints]="[0.5, 0.75, 1]" [keepContentsMounted]="true" mode="md" [backdropDismiss]="false" [showBackdrop]="true">
    <ng-template>
      <ion-content>
        <ion-datetime presentation="month-year" size="cover" mode="md" [(ngModel)]="payslipDate" #yearMonth (ionChange)="selectPayslipDate($any($event))">
          <ion-label slot="title">Select Year and Month</ion-label>
          <ion-buttons slot="buttons">
            <ion-button mode="md" color="danger" (click)="yearMonth.cancel(); dateModal = false;">Cancel</ion-button>
            <ion-button mode="md" color="primary" [disabled]="!payslipDate" (click)="yearMonth.confirm(); dateModal = false;">Done</ion-button>
          </ion-buttons>
        </ion-datetime>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-segment [scrollable]="true" [(ngModel)]="activeTab" class="tab_segement">
    <ion-segment-button value="earning">
      <ion-label>Earning</ion-label>
    </ion-segment-button>
    <ion-segment-button value="deductions" [disabled]="earningForm.invalid" (click)="saveEarnings()">
      <ion-label>Deductions</ion-label>
    </ion-segment-button>
    <ion-segment-button value="payslip" [disabled]="earningForm.invalid || deductionForm.invalid">
      <ion-label>Payslip</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div [ngSwitch]="activeTab">
    <div *ngSwitchCase="'earning'">
      <form [formGroup]="earningForm" class="ion-padding">
        <div class="form-input">
          <ion-item [lines]="'full'" [button]="false" [detail]="false">
            <ion-input type="number" labelPlacement="floating" label="CTC" aria-label="CTC" formControlName="ctc" [min]="0"></ion-input>
          </ion-item>

          <!-- <ion-text color="danger" class="error_txt" *ngIf="earningForm.controls['creditCycle'].touched && earningForm.controls['creditCycle'].errors">
            CTC is required
          </ion-text> -->
        </div>
        
        <div class="form-input">
          <ion-item [lines]="'full'" [button]="false" [detail]="false">
            <ion-input type="number" labelPlacement="floating" label="HRA" aria-label="HRA" formControlName="hra" [min]="0"></ion-input>
          </ion-item>
        </div>

        <div class="form-input">
          <ion-item [lines]="'full'" [button]="false" [detail]="false">
            <ion-input type="number" labelPlacement="floating" label="basics" aria-label="basics" formControlName="basics" [min]="0"></ion-input>
          </ion-item>
        </div>

        <div class="form-input">
          <ion-item [lines]="'full'" [button]="false" [detail]="false">
            <ion-input type="number" labelPlacement="floating" label="Salary" aria-label="Salary" formControlName="salary" [min]="0"></ion-input>
          </ion-item>
        </div>

        <div class="form-input">
          <ion-item [lines]="'full'" [button]="false" [detail]="false">
            <ion-input type="number" labelPlacement="floating" label="Special Allowance" aria-label="Special Allowance" formControlName="specialAllowance" [min]="0"></ion-input>
          </ion-item>
        </div>

        <ion-buttons class="btn-group ion-margin-vertical ion-padding-top">
          <ion-button mode="md" color="danger" fill="solid" shape="round" (click)="earningForm.reset()">Reset</ion-button>
          <ion-button mode="md" color="primary" fill="solid" shape="round" [disabled]="earningForm.invalid" (click)="saveEarnings()">Next</ion-button>
        </ion-buttons>
      </form>
      
      <div class="sum_earning_item">
        <ion-item [lines]="'none'" color="primary" [button]="false">
          <ion-label>Sum of Earnings</ion-label>
          <div slot="end" class="sum_earnings">
            <span>200000</span>
          </div>
        </ion-item>
      </div>
    </div>

    <div *ngSwitchCase="'deductions'">
      <form [formGroup]="deductionForm" class="ion-padding">
        <div class="form-input">
          <ion-item [lines]="'full'" [button]="false" [detail]="false">
            <ion-input type="number" aria-label="Loss of Pay" labelPlacement="floating" formControlName="lop" [min]="0">
              <ion-label slot="label" color="danger">Loss of Pay</ion-label>
            </ion-input>
            <ion-text slot="end">Days</ion-text>
          </ion-item>
        </div>

        <div class="form-input">
          <ion-item [lines]="'full'" [button]="false" [detail]="false">
            <ion-textarea labelPlacement="floating" label="Comment" aria-label="Comment" formControlName="comment" rows="1"></ion-textarea>
          </ion-item>
        </div>

        <div class="form-input">
          <ion-item [lines]="'full'" [button]="false" [detail]="false">
            <ion-input type="number" labelPlacement="floating" label="Income Tax" aria-label="Income Tax" formControlName="incomeTax" [min]="0"></ion-input>
          </ion-item>
        </div>

        <div class="form-input">
          <ion-item [lines]="'full'" [button]="false" [detail]="false">
            <ion-input type="number" labelPlacement="floating" label="PT" aria-label="PT" formControlName="pt" [min]="0"></ion-input>
          </ion-item>
        </div>

        <ion-buttons class="btn-group ion-margin-vertical ion-padding-top">
          <ion-button mode="md" color="danger" fill="solid" shape="round" (click)="activeTab = 'earning';deductionForm.reset()">Back</ion-button>
          <ion-button mode="md" color="primary" fill="solid" shape="round" [disabled]="deductionForm.invalid" (click)="submit()">Save</ion-button>
        </ion-buttons>
      </form>

      <div class="sum_earning_item">
        <ion-item [lines]="'none'" color="primary" [button]="false">
          <ion-label>Sum of Deductions</ion-label>
          <div slot="end" class="sum_earnings">
            <span>0</span>
          </div>
        </ion-item>
      </div>
    </div>

    <div *ngSwitchCase="'payslip'"></div>
    
    <div *ngSwitchDefault></div>
  </div>

</ion-content>
