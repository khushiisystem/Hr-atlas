<ion-header [translucent]="true" mode="md">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button mode="md" fill="clear" [routerDirection]="'back'" (click)="goBack()" class="noBg noRipple">
        <ion-icon name="chevron-back-outline" aria-hidden="true" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>
      <span>Payslip Download</span>
    </ion-title>
    <ion-thumbnail slot="end" class="logo_img ion-margin-end">
      <ion-img src="../../../assets/icon/hr-atlas_48.png" alt="HR-Atlas"></ion-img>
    </ion-thumbnail>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" color="light">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ng-container>

    <div class="container ion-padding-top">
      <div class="stickyTop ion-padding-bottom">
        <div class="optbar">
          <ion-item detail="false" lines="none" mode="md">
            <ion-icon name="search" aria-hidden="true" size="small" slot="start" class="startIcon"></ion-icon>
            <ion-input placeholder="Search" [clearOnEdit]="true" color="tertiary" [clearInput]="true"
              [(ngModel)]="searchString" (ionInput)="onSearch()"></ion-input>
          </ion-item>
          <ion-button fill="clear" mode="md" color="tertiary" shape="round" aria-label="Option" id="optionPop"
            class="ion-margin-start ion-no-padding">
            <ion-icon name="funnel" aria-hidden="true" aria-label="Option"></ion-icon>
          </ion-button>
        </div>
        <ion-popover trigger="optionPop" dismissOnSelect="true" size="auto" side="bottom" alignment="end"
          class="filter">
          <ng-template>
            <ion-content><ion-item lines="none" detail="false" type="button" button="true"
                [color]="empType === 'Active' ? 'tertiary' : ''" mode="ios"
                (click)="getTypedEmployee('Active')">Active</ion-item>
              <ion-item lines="none" detail="false" type="button" button="true"
                [color]="empType === 'Resigned' ? 'tertiary' : ''" mode="ios"
                (click)="getTypedEmployee('Resigned')">Resigned</ion-item>
            </ion-content>
          </ng-template>
        </ion-popover>

        <div class="optbar btns" *ngIf="employeeList.length > 0 && empType != 'InActive'">
          <ion-chip mode="ios"
            [ngClass]="selectedEmployee.length > (employeeList.length-1) ? 'chipBtn filled' : 'chipBtn'"
            color="tertiary" aria-label="mark all" (click)="allSelect()">
            <ion-icon name="checkmark" aria-hidden="true" aria-label="mark all"></ion-icon>
            <ion-label>Mark All</ion-label>
          </ion-chip>
          <ion-chip mode="ios" class="chipBtn" color="tertiary" [disabled]="selectedEmployee.length == 0"
            (click)="deselectAll()">Unmark All</ion-chip>
          <ion-button mode="md" color="tertiary" class="" fill="solid" shape="round" size="small"
            (click)="openCalendar = true">
            <ion-label>{{payslipDate | date:'MMM, y'}}</ion-label>
            <ion-icon slot="end" name="calendar-number-outline"></ion-icon>
          </ion-button>
        </div>
      </div>


      <ion-modal [isOpen]="openCalendar" #dateModal [initialBreakpoint]=".65" [keepContentsMounted]="true" mode="ios"
        [backdropDismiss]="false" [showBackdrop]="true" (didDismiss)="openCalendar = false;">
        <ng-template>
          <ion-content>
            <ion-datetime presentation="month-year" size="cover" mode="md" [firstDayOfWeek]="1" #yearMonth
              [max]="today.toISOString()" (ionChange)="selectPayslipDate($any($event))">
              <ion-label slot="title">Select Year and Month</ion-label>
              <ion-buttons slot="buttons">
                <ion-button mode="md" color="danger"
                  (click)="yearMonth.cancel();dateModal.dismiss()">Cancel</ion-button>
                <ion-button mode="md" color="primary" [disabled]="!payslipDate"
                  (click)="yearMonth.confirm();dateModal.dismiss();">Done</ion-button>
              </ion-buttons>
            </ion-datetime>
          </ion-content>
        </ng-template>
      </ion-modal>


      <div class="ion-text-center ion-margin" *ngIf="!isDataLoaded">
        <ion-spinner color="primary" name="circular"></ion-spinner>
      </div>

      <ion-list mode="ios" lines="none">
        <ion-item lines="none" [button]="false" *ngIf="isDataLoaded && employeeList.length === 0">
          <ion-label class="ion-text-center">No any employee.</ion-label>
        </ion-item>

        <ion-item [button]="true" [detail]="false" class="list-item" *ngFor="let employee of employeeList; index as i;">
          <div slot="start" class="check_container" (click)="checkEmployee(employee.guid)">
            <ion-avatar class="employee_img">
              <app-name-img [name]="getName(employee)" [classes]="'sm'"
                *ngIf="employee.imageUrl.trim() === ''"></app-name-img>
              <img alt="imployee" *ngIf="employee.imageUrl.trim() != ''" [src]="employee.imageUrl" />
            </ion-avatar>
            <div class="custom_checkbox" *ngIf="isChecked(employee.guid)">
              <span class="checkmark"></span>
            </div>
          </div>
          <div class="employee_data">
            <ion-label>{{employee.firstName | titlecase}} {{employee.lastName || '' | titlecase}}</ion-label>
            <ion-text class="role" *ngIf="employee"><small>{{employee.jobTitle}}</small></ion-text>
          </div>
          <div (click)="naviagateToPayslip(employee.guid)">
            <ion-button fill="clear" class="custom-arrow-button">
              <ion-icon name="chevron-forward" class="arrow-icon"></ion-icon>
            </ion-button>
          </div>
        </ion-item>
      </ion-list>
    </div>


    <ion-infinite-scroll #infiniteScroll (ionInfinite)="isMoreData ? loadData($any($event)) : ''" [position]="'bottom'">
      <ion-infinite-scroll-content *ngIf="isMoreData" loadingSpinner="bubbles" loadingText="Loading more data...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>

    <div *ngIf="selectedEmployee.length > 0" class="footer">
      <ion-button mode="md" type="button" color="primary" size="large" expand="block" shape="round"
        class="ion-margin-horizontal sendPayBtn" (click)="generatePaySlip($event)">Download Payslips</ion-button>
    </div>

  </ng-container>

</ion-content>