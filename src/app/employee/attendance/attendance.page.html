<ion-header [translucent]="true" mode="md">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button mode="md" fill="clear" [routerDirection]="'back'" (click)="goBack()" class="noBg noRipple">
        <ion-icon name="chevron-back-outline" aria-hidden="true" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Attendance</ion-title>
    <ion-thumbnail slot="end" class="logo_img ion-margin-end">
      <ion-img src="../../../assets/icon/hr-atlas_logo_2.png" alt="HR-Atlas"></ion-img>
    </ion-thumbnail>
    <ion-progress-bar type="indeterminate" *ngIf="!dataLoaded"></ion-progress-bar>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <div class="flex_div_2" *ngIf="!dataLoaded">
    <div class="loader_img">
      <img src="../../../assets/icon/hr-atlas-150x80.png" alt="HR-Atlas">
    </div>
    <ion-spinner [color]="'tertiary'"></ion-spinner>
  </div>
  <div class="container" *ngIf="dataLoaded">
    <div class="btn_group stickyCalender">
      <ion-button mode="md" color="primary" shape="round" type="button" (click)="dateModal = true" fill="solid" mode="md" [strong]="true">
        {{getMonthYear().trim() != '' ? getMonthYear() : 'Select Month'}}
        <ion-icon name="chevron-down-outline" aria-hidden="true" slot="end"></ion-icon>
      </ion-button>
      <ion-button (click)="showCalendar = true" mode="md" [strong]="true" [shape]="'round'" color="secondary" fill="solid">Calendar View</ion-button>
    </div>
    <ion-modal [isOpen]="dateModal" [initialBreakpoint]="0.5" mode="md" [showBackdrop]="true" (didDismiss)="dateModal = false">
        <ng-template>
          <ion-content>
            <ion-datetime presentation="month-year" size="cover" [(ngModel)]="attendanceDate" mode="md" #yearMonth (ionChange)="selectDate($any($event));">
              <ion-label slot="title">Select Year and Month</ion-label>
              <ion-buttons slot="buttons">
                <ion-button mode="md" color="danger" (click)="yearMonth.cancel(); dateModal = false;">Cancel</ion-button>
                <ion-button mode="md" color="primary" [disabled]="!attendanceDate" (click)="yearMonth.confirm(); dateModal = false;">Done</ion-button>
              </ion-buttons>
            </ion-datetime>
          </ion-content>
        </ng-template>
    </ion-modal>


    <!-- ------------ attendance list ----------------- -->
    <div class="attendance_list">
      <div class="ion-text-center" *ngIf="dataLoaded && attendanceList.length < 1">
        <ion-label>Attendance not available of this month.</ion-label>
      </div>
      <ng-container *ngFor="let attendanceItem of attendanceDateList; index as i;">
        <ion-card class="attendance_Card" mode="md">
          <ion-card-header (click)="attendanceItem.clockIn ? collapseCard(i) : ''">
            <ion-card-title>{{attendanceItem.created_date | date}}</ion-card-title>
            <ion-text class="attendance_status" [color]="getStatus(attendanceItem.status)">{{attendanceItem.status}}</ion-text>
          </ion-card-header>
          <ion-card-content *ngIf="expandedCards.includes(i)">
            <ion-row class="sort_desc ion-margin-top">
              <ion-col size="6">
                <ion-text>In Time</ion-text>
              </ion-col>
              <ion-col size="6">
                <ion-label>{{attendanceItem.clockIn | date:'mediumTime'}}</ion-label>
              </ion-col>
              <ion-col size="6">
                <ion-text>Out Time</ion-text>
              </ion-col>
              <ion-col size="6">
                <ion-label *ngIf="!attendanceItem.clockOut">--</ion-label>
                <ion-label *ngIf="attendanceItem.clockOut">{{attendanceItem.clockOut | date:'mediumTime'}}</ion-label>
              </ion-col>
              <ion-col size="6">
                <ion-text>Work Duration <small>(HH:MM:SS)</small></ion-text>
              </ion-col>
              <ion-col size="6">
                <ion-label>{{attendanceItem.workingTime ? attendanceItem.workingTime.slice(0,7) : '--'}}</ion-label>
              </ion-col>
            </ion-row>
          </ion-card-content>
        </ion-card>
      </ng-container>

      <!-- <ng-container *ngFor="let dateItem of attendanceDateList; index as i;">
        <ion-card class="attendance_Card" mode="md" *ngIf="dateItem.getDay() !== 0">
          <ion-card-header (click)="collapseCard(i)">
            <ion-card-title>{{getWeek(dateItem)}}</ion-card-title>
            <ion-text class="attendance_status" [color]="'success'">{{attendanceStatus[0]}}</ion-text>
          </ion-card-header>
          <ion-card-content *ngIf="expandedCards.includes(i)">
            <ion-row class="sort_desc ion-margin-top">
              <ion-col size="6">
                <ion-text>In Time</ion-text>
              </ion-col>
              <ion-col size="6">
                <ion-label>11: 04 AM</ion-label>
              </ion-col>
              <ion-col size="6">
                <ion-text>Out Time</ion-text>
              </ion-col>
              <ion-col size="6">
                <ion-label>08: 04 PM</ion-label>
              </ion-col>
              <ion-col size="6">
                <ion-text>Work Duration</ion-text>
              </ion-col>
              <ion-col size="6">
                <ion-label>09:00</ion-label>
              </ion-col>
            </ion-row>
          </ion-card-content>
        </ion-card>
      </ng-container> -->
    </div>
    
    <ion-infinite-scroll #infiniteScroll (ionInfinite)="loadData($any($event))" [position]="'bottom'">
      <ion-infinite-scroll-content *ngIf="moreData" loadingSpinner="bubbles" loadingText="Loading more data...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>

    <ion-modal [isOpen]="showCalendar" [showBackdrop]="true" [initialBreakpoint]="0.6" (didDismiss)="showCalendar = false" [backdropDismiss]="true">
      <ng-template>
        <ion-content>
          <ion-datetime presentation="date" [(ngModel)]="attendanceDate" [highlightedDates]="highlightedDates" (ionChange)="dateChange($any($event)); showCalendar = false"></ion-datetime>
        </ion-content>
      </ng-template>
    </ion-modal>
  </div>
</ion-content>
