<ion-header [translucent]="true" mode="md">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button mode="md" fill="clear" [routerDirection]="'back'" (click)="goBack()" class="noBg noRipple">
        <ion-icon name="chevron-back-outline" aria-hidden="true" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title size="small" color="tertiary">
      <span *ngIf="employee" class="ion-text-nowrap">{{employee.firstName | titlecase}} {{employee.lastName || '' | titlecase}}</span>
      <span *ngIf="!employee" class="ion-text-nowrap">Attendance</span>
      <p class="ion-no-margin" *ngIf="employee">Attendance</p>
    </ion-title>
    <div slot="end" class="ion-margin-end toggleview">
      <ion-button type="button" [fill]="'solid'" shape="round" mode="ios" color="tertiary" size="small" aria-label="Calendar View" (click)="dateModal = true">
        <ion-icon aria-hidden="true" size="small" slot="start" name="calendar"></ion-icon>
        {{getMonthYear().trim() != '' ? getMonthYear() : 'Select Month'}}
      </ion-button>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" color="light">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <div class="stickyTab">
    <ion-segment mode="ios" [scrollable]="true" color="secondary" class="topSegment" [(ngModel)]="activeTab">
      <ion-segment-button value="status">Status</ion-segment-button>
      <ion-segment-button value="listView">List View</ion-segment-button>
      <ion-segment-button value="calendarView">Calendar View</ion-segment-button>
      <ion-segment-button value="leaves">Leaves</ion-segment-button>
    </ion-segment>
  </div>

  <div [ngSwitch]="activeTab" *ngIf="employee">
    <div *ngSwitchCase="'status'">
      <ion-grid class="ion-margin-top">
        <ion-row>
          <ion-col size="6" sizeSm="4">
            <circular-progress-bar [value]="getPresent" [maxValue]="getLastDate" color="var(--ion-color-success)"></circular-progress-bar>
            <ion-item lines="none" [detail]="false" color="light">
              <ion-label class="ion-text-center">Present</ion-label>
            </ion-item>
          </ion-col>
          <ion-col size="6" sizeSm="4">
            <circular-progress-bar [value]="getAbsent + getLeaves" [maxValue]="getLastDate" color="var(--ion-color-danger)"></circular-progress-bar>
            <ion-item lines="none" [detail]="false" color="light">
              <ion-label class="ion-text-center">Absent</ion-label>
            </ion-item>
          </ion-col>
          <ion-col size="6" sizeSm="4">
            <circular-progress-bar [value]="leaveLogs.length" [maxValue]="getLastDate" color="var(--ion-color-warning)"></circular-progress-bar>
            <ion-item lines="none" [detail]="false" color="light">
              <ion-label class="ion-text-center">Applied Leaves</ion-label>
            </ion-item>
          </ion-col>
          <ion-col size="6" sizeSm="4">
            <circular-progress-bar [value]="filterLogs('Loss of Pay')" [maxValue]="getLastDate" color="var(--ion-color-danger)"></circular-progress-bar>
            <ion-item lines="none" [detail]="false" color="light">
              <ion-label class="ion-text-center">LOP</ion-label>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <div *ngSwitchCase="'listView'">
      <ng-container *ngFor="let item of dateList; index as a;">
        <attendance-card (regularizationUpdated)="refreshRegularizationData()" [attendanceData]="item" [cardClass]="isAllLoaded() ? item.status : ''" [regularization]="getRegularization(item.created_date)" [isAllGood]="isAllLoaded()" [isWeekOff]="isWeekOff(item.created_date)" [leaveStartDay]="item.leaveData !== null ? getDayType(item.leaveData.from.date, item.leaveData.guid) : ''" [leaveEndDay]="item.leaveData !== null ? getDayType(item.leaveData.to.date, item.leaveData.guid) : ''" [openCard]="a == 0" (attendanceCardAction)="attAcrdAction($event, item)"></attendance-card>
      </ng-container>
      <div class="ion-text-center ion-padding" *ngIf="!isAllLoaded()">
        <ion-spinner color="primary" [name]="'circle'"></ion-spinner>
      </div>
    </div>
    <div *ngSwitchCase="'calendarView'">
      <ion-list inset="true" mode="ios">
        <ion-item detail="false" class="calendarControls">
          <ion-buttons slot="start">
            <ion-button color="tertiary" shape="round" fill="clear" strong="true" class="ion-no-margin" aria-label="Next Year" (click)="decrementMonth()">
              <ion-icon slot="icon-only" name="chevron-back" aria-label="Previous Month"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-label class="ion-text-center">{{ attendanceDate | date:"MMMM yyyy" }}</ion-label>
          <ion-buttons slot="end">
            <ion-button color="tertiary" shape="round" fill="clear" strong="true" class="ion-no-margin" (click)="incrementMonth()" aria-label="Next Month" [disabled]="isNextMonth()">
              <ion-icon slot="icon-only" name="chevron-forward" aria-label="Next Month"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-item>
      </ion-list>
      
      <ion-card class="calendar_card">
        <ion-card-content>
          <table>
            <thead>
              <tr>
                <th *ngFor="let day of ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']">{{ day }}</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let week of dates">
                <td *ngFor="let date of week">
                  <span [ngClass]="getStatusByDate(date ?? '')?.status !== '' ? getStatusByDate(date ?? '')?.status + ' active' : ''">{{ date ? getMomentDate(date) : '' }}</span>
                </td>
              </tr>
            </tbody>
          </table>
        </ion-card-content>
      </ion-card>

      <div class="hints ion-padding">
        <ion-label>
          <ion-icon name="square-sharp" size="small" class="hintIcons" color="success"></ion-icon>
          <ion-note>Present</ion-note>
        </ion-label>
        <ion-label>
          <ion-icon name="square-sharp" color="danger" size="small" class="hintIcons"></ion-icon>
          <ion-note>Absent</ion-note>
        </ion-label>
        <ion-label>
          <ion-icon name="square-sharp" size="small" class="hintIcons halfDay"></ion-icon>
          <ion-note>Half Day</ion-note>
        </ion-label>
        <ion-label>
          <ion-icon name="square-sharp" size="small" class="hintIcons weekOff"></ion-icon>
          <ion-note>Week Off</ion-note>
        </ion-label>
        <ion-label>
          <ion-icon name="square-sharp" size="small" class="hintIcons weekOff"></ion-icon>
          <ion-note>Holiday</ion-note>
        </ion-label>
      </div>
    </div>
    <div *ngSwitchCase="'leaves'">
      <leave-card *ngFor="let leaveItem of leaveLogs" [leaveItem]="leaveItem"></leave-card>
      <div class="emptyDiv ion-padding" *ngIf="leaveLoaded && leaveLogs.length < 1">
        <img src="assets/images/empty_bin.svg" class="emptyImg" alt="Empty">
        <ion-label class="ion-text-wrap">No leaves in this month.</ion-label>
      </div>
    </div>
    <div *ngSwitchDefault>output2</div>
  </div>

  <ion-modal [isOpen]="dateModal" [initialBreakpoint]="0.5" mode="md" [showBackdrop]="true" (didDismiss)="dateModal = false" #dateSelectModal>
    <ng-template>
      <ion-content>
        <ion-datetime presentation="month-year" size="cover" mode="md" #yearMonth [value]="attendanceDate" [max]="today.toISOString()" [min]="minDate.toISOString()" (ionChange)="selectDate($any($event));">
          <ion-label slot="title">Select Year and Month</ion-label>
          <ion-buttons slot="buttons">
            <ion-button mode="md" color="danger" (click)="yearMonth.cancel(); dateSelectModal.dismiss();">Cancel</ion-button>
            <ion-button mode="md" color="primary" (click)="yearMonth.confirm(); dateSelectModal.dismiss();">Done</ion-button>
          </ion-buttons>
        </ion-datetime>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
