<div class="container">
  <ion-segment [(ngModel)]="activeTab" mode="md">
    <ion-segment-button value="status">
      <ion-label>Status</ion-label>
    </ion-segment-button>
    <ion-segment-button value="logs">
      <ion-label>Logs</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div *ngIf="activeTab === 'status'">
    <ion-list inset="true" mode="ios" *ngIf="leaveStatus && leaveStatus.loseOfPay && !showApplyForm || selectedLeaveType === 'LOP'">
      <ion-list-header>
        <ion-label>Loss Of Pay</ion-label>
        <ion-button size="small" color="primary" shape="round" strong="true" mode="ios" fill="solid" *ngIf="leaveStatus.loseOfPay.createdLeave > 0 && (!showApplyForm || selectedLeaveType !== 'LOP')" (click)="selectedLeaveType = 'LOP'; showApplyForm = true;" class="applyBtn">
          <ion-label>Apply</ion-label>
        </ion-button>
      </ion-list-header>
      <ion-item detail="false">
        <ion-label>Total:</ion-label>
        <ion-text>{{ leaveStatus.loseOfPay.totalLeave }}</ion-text>
      </ion-item>
      <ion-item detail="false">
        <ion-label>Credited:</ion-label>
        <ion-text>{{ leaveStatus.loseOfPay.createdLeave }}</ion-text>
      </ion-item>
      <ion-item detail="false">
        <ion-label>Applied:</ion-label>
        <ion-text>{{ leaveStatus.loseOfPay.applyLeave }}</ion-text>
      </ion-item>
    </ion-list>


    <ion-list inset="true" mode="ios" *ngIf="leaveStatus && leaveStatus.casualLeave && !showApplyForm || selectedLeaveType === 'CL'">
      <ion-list-header>
        <ion-label>Casual Leaves</ion-label>
        <ion-button size="small" color="primary" shape="round" strong="true" mode="ios" fill="solid" class="applyBtn" *ngIf="leaveStatus.casualLeave.createdLeave > 0 && (!showApplyForm || selectedLeaveType !== 'CL')" (click)="selectedLeaveType = 'CL'; showApplyForm = true;">Apply</ion-button>
      </ion-list-header>
      <ion-item detail="false">
        <ion-label>Total:</ion-label>
        <ion-text>{{ leaveStatus.casualLeave.totalLeave }}</ion-text>
      </ion-item>
      <ion-item detail="false">
        <ion-label>Credited:</ion-label>
        <ion-text>{{ leaveStatus.casualLeave.createdLeave }}</ion-text>
      </ion-item>
      <ion-item detail="false">
        <ion-label>Applied:</ion-label>
        <ion-text>{{ leaveStatus.casualLeave.applyLeave }}</ion-text>
      </ion-item>
    </ion-list>

    <ion-card class="leave_card" mode="md" *ngIf="showApplyForm && selectedLeaveType === 'LOP'">
      <ion-card-header>
        <ion-card-title>Apply LOP Leave</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <app-leave-apply-form [leaveType]="'Loss of Pay'" (saveForm)="leaveApply($event)"
        ></app-leave-apply-form>
        <ion-button mode="md" fill="solid" expand="block" color="danger" shape="round" strong="true" class="ion-margin-top" (click)="showApplyForm = false; selectedLeaveType = ''">Cancel</ion-button>
      </ion-card-content>
    </ion-card>

    <ion-card class="leave_card" mode="md" *ngIf="showApplyForm && selectedLeaveType === 'CL'">
      <ion-card-header>
        <ion-card-title>Apply Casual Leave</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <app-leave-apply-form [leaveType]="'Casual Leave'" (saveForm)="leaveApply($event)"
        ></app-leave-apply-form>
        <ion-button mode="md" fill="solid" expand="block" color="danger" shape="round" strong="true" class="ion-margin-top" (click)="showApplyForm = false; selectedLeaveType = ''">Cancel</ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <div *ngIf="activeTab === 'logs'">
    <ion-card mode="ios" *ngIf="leaveLogs.length < 1">
      <ion-item class="ion-text-center" [lines]="'none'" [detail]="false">
        <ion-label>Logs are empty.</ion-label>
      </ion-item>
    </ion-card>
    <ion-card class="log_card" *ngFor="let leaveItem of leaveLogs; index as a">
      <ion-card-header>
        <ion-card-title>{{leaveItem.leaveType}}</ion-card-title>
        <div class="ion-text-end">
          <ion-chip [color]="getStatus(leaveItem.status).color">{{getStatus(leaveItem.status).leaveStatus}}</ion-chip>
        </div>
      </ion-card-header>
      <ion-card-content>
        <ion-row class="ion-margin-bottom">
          <ion-col size="6">
            <div class="flex-div">
              <ion-label>Applied On</ion-label>
              <ion-text>{{leaveItem.created_date | date}}</ion-text>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="flex-div">
              <ion-label>Day Type</ion-label>
              <ion-text>{{leaveItem.dayType}}</ion-text>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="flex-div">
              <ion-label>From</ion-label>
              <ion-text>{{leaveItem.startDate | date}}</ion-text>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="flex-div">
              <ion-label>To</ion-label>
              <ion-text>{{leaveItem.endDate | date}}</ion-text>
            </div>
          </ion-col>
        </ion-row>
        <p class="purpose">
          <strong>Purpose: </strong> <ion-text>{{leaveItem.purpose}}</ion-text>
        </p>
        <div class="flexItem">
          <ion-button *ngIf="leaveItem.status === 'Pending'" color="danger" mode="md" fill="solid" [strong]="true" shape="round" class="cancelBtn" (click)="cancelLeave(leaveItem.guid)">Cancel Leave</ion-button>
        </div>
      </ion-card-content>
    </ion-card>
    
    
    <ion-infinite-scroll #infiniteScroll (ionInfinite)="loadLogs($any($event))" [position]="'bottom'">
      <ion-infinite-scroll-content *ngIf="moreData" loadingSpinner="bubbles" loadingText="Loading more data...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </div>
</div>
